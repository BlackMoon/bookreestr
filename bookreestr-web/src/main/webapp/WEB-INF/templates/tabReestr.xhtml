<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"	
	xmlns:ace="http://www.icefaces.org/icefaces/components">
	
	<ace:confirmationDialog  widgetVar="confirmation"
                             message="Удалить запись?"
                             header="Внимание"
                             width="360"
                             height="180"
                             closable="true"
                             position="center">
         <h:panelGrid columns="2" styleClass="centeredPanelGrid">
             <h:commandButton value="Да" onclick="confirmation.hide()" actionListener="#{reestrBean.delete}"/>
             <h:commandButton value="Нет" onclick="confirmation.hide()" />
         </h:panelGrid>
     </ace:confirmationDialog>
	
	<h:panelGrid columns="2" rendered="#{request.userPrincipal != null}">
		<ace:pushButton value="Добавить" actionListener="#{reestrBean.add}"/>		
		<ace:pushButton value="Удалить" styleClass="ice-pushbutton ui-state-disabled" rendered="#{!reestrBean.isSelected}"/>
		<ace:pushButton value="Удалить" styleClass="ice-pushbutton" rendered="#{reestrBean.isSelected}" onclick="confirmation.show()"/>		
	</h:panelGrid>
	
	<ace:dataTable id="gridReestr" value="#{reestrBean.items}" 
					var="reestr"					 
					paginator="true" 
					paginatorPosition="bottom"
					reorderableColumns="true"
					rows="20"
					stateMap="#{reestrBean.stateMap}"	
					selectionMode="single"
					rowSelectListener="#{reestrBean.select}"
					rowUnSelectListener="#{reestrBean.unselect}"> 			                  
              <ace:column id="book" headerText="Книга" sortBy="#{reestr.book}" filterBy="#{reestr.book}">
              	<ace:cellEditor>
                  	<f:facet name="output">
                      	<h:outputText id="bookCell" value="#{reestr.book}" />
                   	</f:facet>
                   	<f:facet name="input">
                   		<h:selectOneMenu id="bookInput" value="#{reestr.bookid}" required="true">
                       		<f:selectItems value="#{bookBean.items}" var="book" itemLabel="#{book}" itemValue="#{book.id}" />                       		
                       	</h:selectOneMenu>
                   	</f:facet>
                </ace:cellEditor>              	
              </ace:column>   
              <ace:column id="reader" headerText="Читатель" sortBy="#{reestr.reader}" filterBy="#{reestr.reader}" >
              	<ace:cellEditor>
                  	<f:facet name="output">
                      	<h:outputText id="readerCell" value="#{reestr.reader}"/>
                   	</f:facet>
                   	<f:facet name="input">
                       	<h:selectOneMenu id="readerInput" value="#{reestr.readerid}" required="true">
                       		<f:selectItems value="#{readerBean.items}" var="reader" itemLabel="#{reader}" itemValue="#{reader.id}" />                       		
                       	</h:selectOneMenu>
                   	</f:facet>
                </ace:cellEditor>              	
              </ace:column>
              <ace:column id="startDate" headerText="Дата выдачи" sortBy="#{reestr.startDate}" filterBy="#{reestr.startDate}" >
              	<ace:cellEditor>
                  	<f:facet name="output">
                      	<h:outputText id="startDateCell" value="#{reestr.startDate}">
                      		<f:convertDateTime pattern="dd.MM.yyyy"/>
                      	</h:outputText>
                   	</f:facet>
                   	<f:facet name="input">
                   		<ace:dateTimeEntry id="startDateInput" renderAsPopup="true" pattern="dd.MM.yyyy" value="#{reestr.startDate}" timeZone="Russia"/>                   		                       	
                   	</f:facet>            	
                </ace:cellEditor>
              </ace:column>
              <ace:column id="endDate" headerText="Дата возврата" sortBy="#{reestr.endDate}" filterBy="#{reestr.endDate}" >
              	<ace:cellEditor>
              		<f:facet name="output">
                      	<h:outputText id="endDateCell" value="#{reestr.endDate}">
                      		<f:convertDateTime pattern="dd.MM.yyyy"/>
                      	</h:outputText>
                   	</f:facet>
                   	<f:facet name="input">
                   		<ace:dateTimeEntry id="endDateInput" renderAsPopup="true" pattern="dd.MM.yyyy" value="#{reestr.endDate}"/>                   		                       	
                   	</f:facet>
              	</ace:cellEditor>            	
              </ace:column>
              <ace:column id="misc" rendered="#{request.userPrincipal != null}">
              	<ace:rowEditor id="editor" 
              		rowEditListener="#{reestrBean.edit}"               		
              		cancelTitle="Отмена" 
              		startTitle="Редактировать" 
              		submitTitle="Сохранить"/>                   		
              </ace:column>                             
       	</ace:dataTable>
</ui:composition>
